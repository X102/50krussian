<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª´ ƒêi·ªÉn T·∫ßn Su·∫•t Ti·∫øng Nga (Full Features)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #0d6efd; --bg-color: #f0f2f5; }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', sans-serif; }

        /* --- THANH C√îNG C·ª§ --- */
        .sticky-header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* --- B·ªê C·ª§C MASONRY --- */
        .masonry-container { column-count: 1; column-gap: 15px; }
        @media (min-width: 576px) { .masonry-container { column-count: 2; } }
        @media (min-width: 992px) { .masonry-container { column-count: 3; } }
        @media (min-width: 1200px) { .masonry-container { column-count: 4; } }

        /* --- TH·∫∫ T·ª™ V·ª∞NG --- */
        .word-card {
            break-inside: avoid;
            background: white; border-radius: 10px; margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            position: relative; overflow: hidden; transition: transform 0.2s;
        }
        .word-card:hover { border-color: #b0c4de; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .word-card.no-meaning { background: #fafafa; border-style: dashed; }

        .lemma { font-size: 1.4rem; font-weight: 700; color: var(--primary-color); cursor: pointer; }
        .lemma:hover { text-decoration: underline; }
        
        /* --- N·ªòI DUNG & N√öT XEM TH√äM --- */
        .meaning-wrapper { position: relative; font-size: 0.95rem; color: #333; line-height: 1.5; }
        .meaning-collapsed {
            max-height: 120px; overflow: hidden;
            mask-image: linear-gradient(180deg, #000 60%, transparent);
            -webkit-mask-image: linear-gradient(180deg, #000 60%, transparent);
        }
        .toggle-btn {
            display: none; width: 100%; background: #f8f9fa; border: none;
            border-top: 1px solid #eee; padding: 5px 0;
            color: var(--primary-color); font-size: 0.85rem; font-weight: 600;
            cursor: pointer; transition: background 0.2s;
        }
        .toggle-btn:hover { background: #e9ecef; }

        /* Style Format T·ª´ ƒëi·ªÉn */
        .stress { color: #d63384; font-weight: bold; }
        .example { display: block; margin-top: 4px; color: #666; font-style: italic; font-size: 0.9em; padding-left: 10px; border-left: 2px solid #eee; }
        .rank-badge { float: right; font-size: 0.75rem; background: #eee; padding: 2px 6px; border-radius: 4px; color: #555; }
        .word-card .btn-light { border: 1px solid #eee; transition: all 0.2s; }
        .word-card .btn-light:hover { background-color: #e9ecef; border-color: #cbd3da; transform: translateY(-1px); }

        /* --- N√öT ƒêI·ªÄU H∆Ø·ªöNG (SCROLL BUTTONS) --- */
        .scroll-btn {
            position: fixed; right: 30px; width: 45px; height: 45px;
            border-radius: 50%; border: none; font-size: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: none; z-index: 999; cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }
        .scroll-btn:hover { transform: scale(1.1); }
        
        #btnScrollTop { bottom: 85px; background: #343a40; color: white; } /* N√∫t l√™n n·∫±m tr√™n */
        #btnScrollBottom { bottom: 30px; background: var(--primary-color); color: white; } /* N√∫t xu·ªëng n·∫±m d∆∞·ªõi */

    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container-fluid px-4">
        <div class="row align-items-center g-2">
            <div class="col-12 col-md-3">
                <div class="fw-bold text-primary fs-5">50,000 T·ª´ v·ª±ng ti·∫øng Nga</div>
                <small class="text-muted" id="statusDisplay">ƒêang t·∫£i...</small>
            </div>
            <div class="col-8 col-md-6">
                <input type="text" id="searchInput" class="form-control" placeholder="T√¨m ki·∫øm t·ª´ (nguy√™n th·ªÉ) ho·∫∑c nghƒ©a...">
            </div>
            <div class="col-4 col-md-3 d-flex">
                <input type="number" id="rankInput" class="form-control me-2" placeholder="T√¨m theo s·ªë th·ª© t·ª± (1-49998)" min="1">
                <button class="btn btn-primary" onclick="jumpToRank()">Go</button>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid px-4 py-3">
    <div id="wordList" class="masonry-container"></div>
    
    <div class="text-center py-4">
        <div id="loadingSpinner" class="spinner-border text-primary" role="status"></div>
        <button id="loadMoreBtn" class="btn btn-outline-primary px-5 rounded-pill shadow-sm" style="display:none;">Xem th√™m</button>
    </div>
</div>
<footer class="bg-white border-top mt-5 pt-5 pb-5">
    <div class="container">
        <div class="row">
            <div class="col-md-5 mb-4">
                <h5 class="fw-bold text-primary">V·ªÅ b·ªô t·ª´ ƒëi·ªÉn n√†y</h5>
                <p class="text-muted">
                    Trang web n√†y ƒë∆∞·ª£c x√¢y d·ª±ng ƒë·ªÉ gi√∫p ng∆∞·ªùi Vi·ªát Nam tra c·ª©u, h·ªçc 50.000 t·ª´ v·ª±ng ti·∫øng Nga ph·ªï bi·∫øn nh·∫•t. 
                    D·ªØ li·ªáu ƒë∆∞·ª£c s·∫Øp x·∫øp t·ª´ xu·∫•t hi·ªán nhi·ªÅu nh·∫•t ƒë·∫øn √≠t h∆°n, t√≠ch h·ª£p nghƒ©a ti·∫øng Vi·ªát v√† c√°c c√¥ng c·ª• tra c·ª©u m·ªü r·ªông.
                </p>
            </div>

            <div class="col-md-4 mb-4">
                <h5 class="fw-bold">üìä Ngu·ªìn d·ªØ li·ªáu</h5>
                <ul class="list-unstyled text-muted">
                    <li class="mb-2">
                        üîπ <strong>T·ª´ ƒëi·ªÉn t·∫ßn su·∫•t t·ª´:</strong> 
                        <a href="https://github.com/Digital-Pushkin-Lab/Russian_frequency_lists" target="_blank" class="text-decoration-none"> Digital Pushkin Lab</a>
                    </li>
                    <li class="mb-2">
                        üîπ <strong>Nghƒ©a ti·∫øng Vi·ªát:</strong> 
                        <a href="https://huggingface.co/datasets/lopmaybay/trungvietstardict" target="_blank" class="text-decoration-none">T·ª´ ƒëi·ªÉn Nga Vi·ªát StarDict</a>
                    </li>
                    <li>
                        üîπ <strong>Tra c·ª©u ngo√†i:</strong> Google Translate, Yandex, Google Images, Vtudien, Youglish, Wikitionary.
                    </li>
                </ul>
            </div>

            <div class="col-md-3 mb-4">
                <h5 class="fw-bold">üë®‚Äçüíª Li√™n h·ªá t√°c gi·∫£</h5>
                <p class="text-muted">
                    Ph√°t tri·ªÉn b·ªüi: <strong>Ph·∫°m ƒêƒÉng Hi·ªÉn</strong><br>
                    <small>lopmaybay@gmail.com</small>
                </p>
                <div>
                    <a href="https://t.me/lopmaybay" class="btn btn-outline-secondary btn-sm me-1">Telegram</a>
                    <a href="https://www.facebook.com/lopmaybay" class="btn btn-outline-primary btn-sm">Facebook</a>
                </div>
            </div>
        </div>

        <div class="text-center text-muted border-top pt-3 mt-3 small">
            &copy; 2025 Russian Frequency Dictionary. All rights reserved.
        </div>
    </div>
</footer>
<button onclick="scrollToTopFn()" id="btnScrollTop" class="scroll-btn" title="L√™n ƒë·∫ßu trang">‚¨Ü</button>
<button onclick="scrollToTopFn()" id="btnScrollTop" class="scroll-btn" title="L√™n ƒë·∫ßu trang">‚¨Ü</button>
<button onclick="scrollToBottomFn()" id="btnScrollBottom" class="scroll-btn" title="Xu·ªëng cu·ªëi trang">‚¨á</button>

<script>
    const DATA_URL = 'russian_learning_data(5).json'; 
    const BATCH_SIZE = 50;

    let fullDataset = [];
    let currentData = [];
    let renderedCount = 0;

    async function init() {
        try {
            const res = await fetch(DATA_URL);
            fullDataset = await res.json();
            currentData = fullDataset;
            
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('statusDisplay').innerText = `T·ªïng: ${fullDataset.length.toLocaleString()} t·ª´`;
            
            renderNextBatch();
        } catch (e) {
            alert("L·ªói t·∫£i data: " + e.message);
        }
    }

    function cleanRawMeaning(html) {
        if (!html) return "";
        let clean = html;
        clean = clean.replace(/\[p\](.*?)\[\/p\]/g, '<span class="text-secondary fst-italic small"> ($1) </span>');
        clean = clean.replace(/\[\/?m\d?\]/g, '');
        clean = clean.replace(/\\/g, '');
        clean = clean.replace(/~/g, '<b class="text-primary">~</b>');
        clean = clean.replace(/^(<br>)+|(<br>)+$/g, '');
        return clean;
    }

    function renderNextBatch() {
        const container = document.getElementById('wordList');
        const batch = currentData.slice(renderedCount, renderedCount + BATCH_SIZE);
        
        if (batch.length === 0) {
            document.getElementById('loadMoreBtn').style.display = 'none';
            if(renderedCount === 0) container.innerHTML = `<div class="lemma mb-1" onclick="speak('${searchInput.value}')">${searchInput.value} üîä</div>
                        <a href="https://translate.google.com/?sl=ru&tl=vi&text=${searchInput.value}" target="_blank"> Tra Google d·ªãch |</a>
                        <a href="https://vtudien.com/nga-viet/dictionary/nghia-cua-tu-${searchInput.value}" target="_blank"> Tra Vtudien |<a/>
                        <a href="https://youglish.com/pronounce/${searchInput.value}/russian" target="_blank"> Tra Youglish |<a/>
                        <a href="https://ru.wiktionary.org/wiki/${searchInput.value}" target="_blank"> Tra Wikitionary <a/><br\>  
                        <p class="text-center w-100">Kh√¥ng t√¨m th·∫•y.</p> <\div>`;
            return;
        }

        let html = '';
        batch.forEach((item, index) => {
            const realRank = fullDataset.indexOf(item) + 1;
            const uniqueId = `word-${renderedCount + index}`;
            
            let hasMeaning = !!item.meaning;
            let rawContent = item.meaning ? cleanRawMeaning(item.meaning) : '';
            let meaningHtml = rawContent || `<div class="text-muted small mt-2">Ch∆∞a c√≥ d·ªØ li·ªáu nghƒ©a. H√£y t·ª± tra th√™m!</div>`;

            let isLongContent = hasMeaning && item.meaning.length > 250; 
            let collapseClass = isLongContent ? 'meaning-collapsed' : '';
            let btnDisplay = isLongContent ? 'block' : 'none';

            // T·∫°o link t√¨m ki·∫øm
            const yandexUrl = `https://yandex.ru/search/?text=${encodeURIComponent(item.lemma)}`;
            const googleUrl = `https://www.google.com/search?q=t·ª´+v·ª±ng+ti·∫øng+nga+${encodeURIComponent(item.lemma)}`;
            const googleImgUrl = `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(item.lemma)}`;

            html += `
                <div class="word-card ${hasMeaning?'':'no-meaning'}">
                    <div class="p-3">
                        <span class="rank-badge">#${realRank}</span>
                        <div class="lemma mb-1" onclick="speak('${item.lemma}')">${item.lemma} üîä</div>

                        <div id="content-${uniqueId}" class="meaning-wrapper ${collapseClass} mb-3">
                            ${meaningHtml}
                        </div>

                        <div class="d-flex gap-2 pt-2 border-top">
                            <a href="${yandexUrl}" target="_blank" class="btn btn-sm btn-light flex-fill text-danger fw-bold">Yandex</a>
                            <a href="${googleUrl}" target="_blank" class="btn btn-sm btn-light flex-fill text-primary fw-bold">Google</a>
                            <a href="${googleImgUrl}" target="_blank" class="btn btn-sm btn-light text-secondary">üñºÔ∏è</a>
                            
                        </div>
                        <a href="https://translate.google.com/?sl=ru&tl=vi&text=${item.lemma}" target="_blank"> Google Translate |</a>
                        <a href="https://vtudien.com/nga-viet/dictionary/nghia-cua-tu-${item.lemma}" target="_blank"> Vtudien |<a/>
                        <a href="https://youglish.com/pronounce/${item.lemma}/russian" target="_blank"> Youglish |<a/>
                        <a href="https://ru.wiktionary.org/wiki/${item.lemma}" target="_blank"> Wikitionary <a/><br\>  
                    </div>
                    
                    <button id="btn-${uniqueId}" class="toggle-btn" style="display:${btnDisplay}" 
                            onclick="toggleCard('${uniqueId}')">
                        üîΩ Xem chi ti·∫øt
                    </button>
                </div>
            `;
        });

        container.insertAdjacentHTML('beforeend', html);
        renderedCount += batch.length;

        const loadMoreBtn = document.getElementById('loadMoreBtn');
        loadMoreBtn.style.display = (renderedCount >= currentData.length) ? 'none' : 'inline-block';
        loadMoreBtn.innerText = `T·∫£i th√™m (${renderedCount}/${currentData.length})`;
    }

    window.toggleCard = function(id) {
        const content = document.getElementById(`content-${id}`);
        const btn = document.getElementById(`btn-${id}`);
        if (content.classList.contains('meaning-collapsed')) {
            content.classList.remove('meaning-collapsed');
            btn.innerHTML = 'üîº Thu g·ªçn';
            btn.style.background = '#e9ecef';
        } else {
            content.classList.add('meaning-collapsed');
            btn.innerHTML = 'üîΩ Xem chi ti·∫øt';
            btn.style.background = '#f8f9fa';
            content.scrollIntoView({behavior: "smooth", block: "center"});
        }
    };

    const searchInput = document.getElementById('searchInput');
    let timeout = null;
    searchInput.addEventListener('input', (e) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
            const k = e.target.value.toLowerCase().trim();
            document.getElementById('wordList').innerHTML = '';
            renderedCount = 0;
            if(!k) currentData = fullDataset;
            else currentData = fullDataset.filter(i => 
                (i.lemma && i.lemma.toLowerCase().includes(k)) || 
                (i.meaning && i.meaning.toLowerCase().includes(k))
            );
            renderNextBatch();
        }, 300);
    });

    document.getElementById('loadMoreBtn').addEventListener('click', renderNextBatch);

    window.jumpToRank = function() {
        const r = parseInt(document.getElementById('rankInput').value);
        if(!r || r < 1) return;
        document.getElementById('wordList').innerHTML = '';
        currentData = fullDataset;
        renderedCount = Math.min(r - 1, fullDataset.length - 1);
        renderNextBatch();
        window.scrollTo(0,0);
        searchInput.value = '';
    }

    window.speak = function(t) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'ru-RU';
        window.speechSynthesis.speak(u);
    }

    // --- X·ª¨ L√ù SCROLL N√öT ƒêI·ªÄU H∆Ø·ªöNG ---
    
    // H√†m cu·ªôn l√™n ƒë·∫ßu
    window.scrollToTopFn = function() {
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    // H√†m cu·ªôn xu·ªëng cu·ªëi
    window.scrollToBottomFn = function() {
        window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
    }

    // Logic ·∫©n hi·ªán n√∫t
    window.onscroll = () => {
        const scrollY = window.scrollY;
        const windowHeight = window.innerHeight;
        const docHeight = document.body.scrollHeight;

        const btnTop = document.getElementById('btnScrollTop');
        const btnBottom = document.getElementById('btnScrollBottom');

        // Hi·ªán n√∫t L√™n n·∫øu cu·ªôn xu·ªëng qu√° 300px
        btnTop.style.display = scrollY > 300 ? 'block' : 'none';

        // Hi·ªán n√∫t Xu·ªëng n·∫øu ch∆∞a ch·∫°m ƒë√°y
        // (Tr·ª´ ƒëi 100px ƒë·ªÉ c√≥ ƒë·ªô tr·ªÖ h·ª£p l√Ω)
        if (windowHeight + scrollY < docHeight - 100) {
            btnBottom.style.display = 'block';
        } else {
            btnBottom.style.display = 'none';
        }
    }

    init();
</script>

</body>
</html>